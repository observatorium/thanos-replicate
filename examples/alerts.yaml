groups:
- name: thanos-replicate.rules
  rules:
  - alert: ThanosReplicateIsDown
    annotations:
      message: Thanos Replicate has disappeared from Prometheus target discovery.
    expr: |
      absent(up{job=~"thanos-replicate.*"})
    for: 5m
    labels:
      severity: critical
  - alert: ThanosReplicateErrorRate
    annotations:
      message: Thanos Replicate failing to run, {{ $value | humanize }}% of attempts
        failed.
    expr: |
      (
        sum(rate(thanos_replicate_replication_runs_total{result="error", job=~"thanos-replicate.*"}))
      / on (namespace) group_left
        sum(rate(thanos_replicate_replication_runs_total{job=~"thanos-replicate.*"}))
      ) * 100 >= 10
    for: 5m
    labels:
      severity: critical
